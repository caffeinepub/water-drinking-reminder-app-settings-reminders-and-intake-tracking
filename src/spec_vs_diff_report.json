{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-09T07:55:37.234Z",
  "summary": "Implemented a device-local offline action queue with localStorage persistence and an online sync provider, plus UI stale-data notices and an offline preference hook/toggle integration. However, the diff evidence is incomplete/truncated for several required mutations and caching hooks, and at least one query appears to still call the backend while offline if no cache exists. Several unrelated UI/theme/reminder changes were also introduced beyond the offline-mode request.",
  "missing_requirements": [
    {
      "id": "REQ-34",
      "requirement": "When offline, submitting addDailyIntake, addSleepLog, logRun, and updateUserSettings should not error and should queue locally, persisted across reloads, then replay automatically in original order on reconnect, keeping failed items queued with a non-blocking English message, and refreshing relevant React Query caches after sync.",
      "reason": "Offline queue + sync provider exist, and updateUserSettings is explicitly queued when offline, but the diff summary is truncated for the addDailyIntake/addSleepLog/logRun mutation implementations. From the provided snippet, only updateUserSettings is confirmed to enqueue offline; the others cannot be verified from the truncated useQueries.ts.",
      "evidence": [
        "frontend/src/offline/offlineQueue.ts",
        "frontend/src/offline/OfflineSyncProvider.tsx",
        "frontend/src/hooks/useQueries.ts (truncated)",
        "frontend/src/components/intake/QuickAddIntake.tsx (expects result?.queued)",
        "frontend/src/components/sleep/SleepLogForm.tsx (expects result?.queued)",
        "frontend/src/components/running/RunLogForm.tsx (expects result?.queued)"
      ]
    },
    {
      "id": "REQ-35",
      "requirement": "Offline read-only rendering does not require any backend calls and does not crash if no cached data exists (falls back to existing empty/loading states).",
      "reason": "In the shown useGetTodaysIntake queryFn, if the browser is offline and offline mode is enabled but no cached data exists, it proceeds to call actor.getTodaysIntake(), which violates the requirement to avoid backend calls while offline and to gracefully fall back when no cache exists.",
      "evidence": [
        "frontend/src/hooks/useQueries.ts (truncated): useGetTodaysIntake queryFn calls actor.getTodaysIntake() even when offline if no cached value is found"
      ]
    },
    {
      "id": "REQ-35",
      "requirement": "Cache the last successfully fetched user data locally for today’s values and history lists for hydration, sleep, and running (per principal), and use those caches when offline.",
      "reason": "Caching is explicitly shown for todaysIntake only in the provided snippet. The diff summary indicates broader offline caching support, but the relevant parts of useQueries.ts for intakeHistory/sleep/running history and today values are truncated, so full coverage for sleep and running (and histories) cannot be confirmed from evidence provided.",
      "evidence": [
        "frontend/src/hooks/useQueries.ts (truncated): explicit cache read/write shown for 'todaysIntake' only",
        "frontend/src/components/history/HistoryView.tsx (uses useIsOfflineData(['intakeHistory']))",
        "frontend/src/components/sleep/SleepHistoryList.tsx (uses useIsOfflineData(['sleepHistory']))",
        "frontend/src/components/running/RunHistoryList.tsx (uses useIsOfflineData(['runningHistory']))"
      ]
    },
    {
      "id": "REQ-36",
      "requirement": "When “Save for offline use” is disabled, the app does not queue new offline actions and does not write new offline caches.",
      "reason": "useOfflinePreference exists and is checked in updateUserSettings and useGetTodaysIntake for caching/reads, but the diff is truncated for other mutation hooks and other query hooks; it cannot be verified that all offline queueing/caching respects the disabled state across hydration, sleep, running, and all relevant cached queries.",
      "evidence": [
        "frontend/src/offline/useOfflinePreference.ts",
        "frontend/src/hooks/useQueries.ts (truncated)"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "Large-scale Gen-Z themed UI copy changes (including emojis) and styling/theme overhauls beyond offline saved-content mode.",
      "reason": "BuildRequest only asks for offline queue + caching + a settings toggle with English helper text; it does not request re-theming, new marketing copy, or emoji-heavy messaging.",
      "evidence": [
        "frontend/src/App.tsx (truncated): new landing copy like “Stay Hydrated, Stay Vibing ✨” and other emoji-heavy text",
        "frontend/src/components/intake/QuickAddIntake.tsx: CHILL_MESSAGES array with emoji-heavy copy",
        "frontend/src/index.css (mentioned in summary): new theme/animations",
        "frontend/tailwind.config.js (mentioned in summary): new color tokens/animations"
      ]
    },
    {
      "description": "Reminder system enhancements and additional reminder types/support not requested as part of offline mode.",
      "reason": "Non-goals/requirements focus on offline persistence and caching; reminder feature work is unrelated to REQ-34/35/36.",
      "evidence": [
        "frontend-file-summaries.txt: frontend/src/components/reminders/ReminderControls.tsx updated with multiple sections and localStorage persistence",
        "frontend-file-summaries.txt: frontend/src/hooks/useReminderScheduler.ts and useReminderSchedulerContext.tsx enhancements"
      ]
    }
  ],
  "confidence": 0.68,
  "changed_files": [
    "frontend-file-summaries.txt",
    "frontend/src/App.tsx",
    "frontend/src/components/history/HistoryView.tsx",
    "frontend/src/components/intake/QuickAddIntake.tsx",
    "frontend/src/components/intake/TodayProgress.tsx",
    "frontend/src/components/offline/OfflineStaleNotice.tsx",
    "frontend/src/components/running/RunHistoryList.tsx",
    "frontend/src/components/running/RunLogForm.tsx",
    "frontend/src/components/settings/SettingsForm.tsx",
    "frontend/src/components/sleep/SleepHistoryList.tsx",
    "frontend/src/components/sleep/SleepLogForm.tsx",
    "frontend/src/hooks/useQueries.ts",
    "frontend/src/offline/OfflineSyncProvider.tsx",
    "frontend/src/offline/offlineQueue.ts",
    "frontend/src/offline/offlineStorage.ts",
    "frontend/src/offline/useOfflinePreference.ts",
    "project_state.json"
  ]
}